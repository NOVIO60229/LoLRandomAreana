<!DOCTYPE html>
<html lang="zh-Hant">


<head>
    <meta charset="UTF-8">
    <title>LOL 精靈圖抽選</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .iconBox {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            margin-top: 16px;
        }
    </style>
</head>

<body>

    <label for="mapSelect">選擇模式：</label>
    <select id="mapSelect">
        <option value="12">咆哮深淵</option>
        <option value="11">召喚峽谷</option>
        <option value="30">競技場</option>
    </select>

    <label for="groupCount">人數：</label>
    <input type="number" id="groupCount" value="1" min="1" max="10" style="width: 50px;">

    <button id="drawButton">抽選</button>

    <div class="iconBox" id="iconBox">
        <div id="championIcon" class="championIcon"></div>
        <div class="itemIcon"></div>
        <div class="itemIcon"></div>
        <div class="runeIcon" id="runeIcon"></div>
        <div class="spellIcon"></div>
        <div class="spellIcon"></div>
    </div>

    <script>

        const mapIdToName = {
            12: "ARAM",
            11: "CLASSIC",
            30: "CHERRY"
        };

        let championList = [];
        let itemList = [];
        let spellList = [];
        let runeList = [];
        let imageVersion = "15.10.1";
        const spriteBasePath = "asset/dragontail";

        // 載入英雄
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/champion.json`)
            .then(res => res.json())
            .then(json => {
                championList = Object.values(json.data);
                imageVersion = json.version;
            });

        // 載入裝備
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/item.json`)
            .then(res => res.json())
            .then(json => {
                itemList = Object.entries(json.data)
                    .map(([id, item]) => ({ id, ...item }))
                    .filter(item =>
                        item.gold.total >= 2200 &&
                        item.gold.purchasable === true
                    );
            });

        // 載入召喚師技能
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/summoner.json`)
            .then(res => res.json())
            .then(json => {
                spellList = Object.values(json.data);
            });

        // 載入符文
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/runesReforged.json`)
            .then(res => res.json())
            .then(json => {
                runeList = json;
            });

        document.getElementById("drawButton").addEventListener("click", () => {

            const selectedMap = document.getElementById("mapSelect").value;
            const mapName = mapIdToName[selectedMap] || "ARAM";
            const groupCount = parseInt(document.getElementById("groupCount").value, 10);

            //隨機打亂英雄，待後續取出
            let remainingChampions = [...championList].sort(() => 0.5 - Math.random());
            //防止抽超過英雄上限
            if (groupCount > championList.length) {
                alert("組數超過可用英雄數量！");
                return;
            }

            const iconBox = document.getElementById("iconBox");
            iconBox.innerHTML = ""; // 清空舊的

            for (let g = 0; g < groupCount; g++) {
                const groupDiv = document.createElement("div");
                groupDiv.className = "iconGroup";

                // 抽英雄
                const champion = remainingChampions.splice(0, 1)[0];
                const champDiv = document.createElement("div");
                champDiv.className = "championIcon";
                champDiv.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/sprite/${champion.image.sprite})`;
                champDiv.style.backgroundPosition = `-${champion.image.x}px -${champion.image.y}px`;
                groupDiv.appendChild(champDiv);

                // 抽裝備
                const items = [...itemList]
                    .filter(item => item.maps && item.maps[selectedMap] === true)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 2);
                for (const item of items) {
                    const itemDiv = document.createElement("div");
                    itemDiv.className = "itemIcon";
                    itemDiv.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/sprite/${item.image.sprite})`;
                    itemDiv.style.backgroundPosition = `-${item.image.x}px -${item.image.y}px`;
                    groupDiv.appendChild(itemDiv);
                }

                // 抽符文
                const primary = runeList[Math.floor(Math.random() * runeList.length)];
                const rune = primary.slots[0].runes[Math.floor(Math.random() * primary.slots[0].runes.length)];
                const runeDiv = document.createElement("div");
                runeDiv.className = "runeIcon";
                runeDiv.style.backgroundImage = `url(${spriteBasePath}/img/${rune.icon})`;
                runeDiv.style.backgroundPosition = "center";
                groupDiv.appendChild(runeDiv);

                // 抽召喚師技能
                const spells = [...spellList]
                    .filter(spell => spell.modes && spell.modes.includes(mapName))
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 2);
                for (const spell of spells) {
                    const spellDiv = document.createElement("div");
                    spellDiv.className = "spellIcon";
                    spellDiv.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/spell/${spell.image.full})`;
                    spellDiv.style.backgroundPosition = "center";
                    groupDiv.appendChild(spellDiv);
                }

                iconBox.appendChild(groupDiv);
            }
        });
    </script>
</body>

</html>