<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>LOL 精靈圖抽選</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h1>抽一位英雄</h1>
    <button id="drawButton">抽選</button>

    <div id="champion">
        <div id="championIcon" class="championIcon"></div>
        <div id="championText">尚未抽選</div>
    </div>
    
    <div id="itemList">
        <div class="item">
            <div class="itemIcon"></div>
            <span>裝備一：尚未抽選</span>
        </div>
        <div class="item">
            <div class="itemIcon"></div>
            <span>裝備二：尚未抽選</span>
        </div>
    </div>

    <script>
        let championList = [];
        let itemList = [];
        let imageVersion = "15.10.1";
        const spriteBasePath = "asset/dragontail"; // 本地圖庫根路徑

        // 載入英雄資料
        fetch('asset/dragontail/15.10.1/data/zh_TW/champion.json')
            .then(res => res.json())
            .then(json => {
                championList = Object.values(json.data);
                imageVersion = json.version;
            });

        // 載入裝備資料
        fetch('asset/dragontail/15.10.1/data/zh_TW/item.json')
            .then(res => res.json())
            .then(json => {
                itemList = Object.entries(json.data)
                    .map(([id, item]) => ({ id, ...item }))
                    .filter(item =>
                        item.gold.total >= 2200 &&
                        item.gold.purchasable === true &&
                        item.maps &&
                        item.maps["12"] === true
                    );
            });

        // 點擊按鈕抽選
        document.getElementById("drawButton").addEventListener("click", () => {
    // 抽英雄
    if (championList.length === 0) return;
    const selected = championList[Math.floor(Math.random() * championList.length)];
    const { sprite, x, y } = selected.image;

    const icon = document.getElementById("championIcon");
    icon.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/sprite/${sprite})`;
    icon.style.backgroundPosition = `-${x}px -${y}px`;

    document.getElementById("championText").textContent =
        `${selected.name}（${selected.title}）`;

    // 抽裝備
    if (itemList.length >= 2) {
        const shuffled = [...itemList].sort(() => 0.5 - Math.random());
        const selectedItems = shuffled.slice(0, 2);

        const itemListDom = document.getElementById("itemList");
        itemListDom.innerHTML = ""; // 清空原本的內容

        for (const item of selectedItems) {
            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");

            const iconDiv = document.createElement("div");
            iconDiv.classList.add("itemIcon");
            
            iconDiv.style.backgroundImage =
                `url(${spriteBasePath}/${imageVersion}/img/sprite/${item.image.sprite})`;
                console.log(`backgroundImage`, iconDiv.style.backgroundImage);
            iconDiv.style.backgroundPosition = `-${item.image.x}px -${item.image.y}px`;

            const nameSpan = document.createElement("span");
            nameSpan.textContent = item.name;

            itemDiv.appendChild(iconDiv);
            itemDiv.appendChild(nameSpan);
            itemListDom.appendChild(itemDiv);
        }
    }
});
    </script>

</body>

</html>