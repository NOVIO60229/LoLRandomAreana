<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>LOL 精靈圖抽選</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .iconBox {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            margin-top: 16px;
        }
    </style>
</head>

<body>

    <label for="mapSelect">選擇模式：</label>
    <select id="mapSelect">
        <option value="12">咆哮深淵</option>
        <option value="11">召喚峽谷</option>
        <option value="30">競技場</option>
    </select>

    <button id="drawButton">抽選</button>

    <div class="iconBox" id="iconBox">
        <div id="championIcon" class="championIcon"></div>
        <div class="itemIcon"></div>
        <div class="itemIcon"></div>
        <div class="runeIcon" id="runeIcon"></div>
        <div class="spellIcon"></div>
        <div class="spellIcon"></div>
    </div>

    <script>
        let championList = [];
        let itemList = [];
        let spellList = [];
        let runeList = [];
        let imageVersion = "15.10.1";
        const spriteBasePath = "asset/dragontail";

        // 載入英雄
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/champion.json`)
            .then(res => res.json())
            .then(json => {
                championList = Object.values(json.data);
                imageVersion = json.version;
            });

        // 載入裝備
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/item.json`)
            .then(res => res.json())
            .then(json => {
                itemList = Object.entries(json.data)
                    .map(([id, item]) => ({ id, ...item }))
                    .filter(item =>
                        item.gold.total >= 2200 &&
                        item.gold.purchasable === true
                    );
            });

        // 載入召喚師技能
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/summoner.json`)
            .then(res => res.json())
            .then(json => {
                spellList = Object.values(json.data);
            });

        // 載入符文
        fetch(`${spriteBasePath}/15.10.1/data/zh_TW/runesReforged.json`)
            .then(res => res.json())
            .then(json => {
                runeList = json;
            });

        document.getElementById("drawButton").addEventListener("click", () => {

            const selectedMap = document.getElementById("mapSelect").value;
            // 抽英雄
            const selectedChampion = championList[Math.floor(Math.random() * championList.length)];
            const { sprite, x, y } = selectedChampion.image;
            const championIcon = document.getElementById("championIcon");
            championIcon.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/sprite/${sprite})`;
            championIcon.style.backgroundPosition = `-${x}px -${y}px`;

            // 抽裝備
            const shuffledItems = [...itemList].filter(item => item.maps && item.maps[selectedMap] === true).sort(() => 0.5 - Math.random()).slice(0, 2);
            document.querySelectorAll('.itemIcon').forEach((el, i) => {
                const item = shuffledItems[i];
                el.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/sprite/${item.image.sprite})`;
                el.style.backgroundPosition = `-${item.image.x}px -${item.image.y}px`;
            });

            // 抽主要天賦（隨機 runeList 中的一個 style）
            const primaryStyle = runeList[Math.floor(Math.random() * runeList.length)];
            const slot0Runes = primaryStyle.slots[0].runes;
            const selectedRune = slot0Runes[Math.floor(Math.random() * slot0Runes.length)];
            const primaryRuneIcon = document.getElementById("runeIcon");
            primaryRuneIcon.style.backgroundImage =
                `url(${spriteBasePath}/img/${selectedRune.icon})`;
            primaryRuneIcon.style.backgroundPosition = "center";

            // 抽召喚師技能 2 個
            const shuffledSpells = [...spellList].sort(() => 0.5 - Math.random()).slice(0, 2);
            document.querySelectorAll('.spellIcon').forEach((el, i) => {
                const spell = shuffledSpells[i];
                el.style.backgroundImage = `url(${spriteBasePath}/${imageVersion}/img/spell/${spell.image.full})`;
                el.style.backgroundPosition = "center";
            });
        });
    </script>
</body>

</html>
